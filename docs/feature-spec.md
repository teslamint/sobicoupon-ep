# 은평구 소비쿠폰 가맹점 위치 검색 시스템 기능 명세서

## 1. 시스템 개요
은평구 소비쿠폰 가맹점의 위치를 검색하고 지도에 표시하는 웹 애플리케이션

## 2. 핵심 기능

### 2.1 데이터 로드 및 캐싱
- **엑셀 파일 업로드**: 가맹점 정보가 담긴 엑셀 파일(.xlsx, .xls) 업로드
  - 여러 시트 지원 (각 시트는 행정동 이름)
  - 유연한 컬럼 매핑 (상호/업체명/가맹점명, 상세주소/주소/소재지)
  - 최대 10MB 파일 크기 제한
  
- **IndexedDB 캐싱**: 
  - 가맹점 정보 자동 저장
  - 검색된 위치 정보 캐싱
  - 페이지 새로고침 시 자동 로드
  - 캐시 삭제 기능

### 2.2 지도 기능
- **카카오맵 API 연동**:
  - 은평구 중심 좌표로 초기화
  - 줌 인/아웃 컨트롤
  - 현재 위치 표시
  
- **마커 표시**:
  - 위치 정보가 있는 가맹점 마커 표시
  - 같은 위치 가맹점 그룹화 (숫자 표시)
  - 마커 클러스터링 (줌 레벨 3부터)
  
- **정보 표시**:
  - 마커 클릭 시 가맹점 정보 팝업
  - 그룹화된 가맹점 목록 팝업

### 2.3 검색 기능

#### 2.3.1 현 지도에서 검색
- **카카오맵 Places API 활용**:
  - 현재 지도 영역 내 장소 검색
  - 카테고리별 검색 (편의점, 음식점, 카페 등)
  - 키워드 검색 (최대 20개)
  
- **매칭 알고리즘**:
  - 상호명 정규화 (특수문자, 공백 제거)
  - 정규화된 이름으로 매칭
  - 은평구 내 장소만 필터링
  
- **결과 표시**:
  - 매칭된 가맹점 지도에 표시
  - 거리 정보 계산 (지도 중심점 기준)
  - 매칭된 가맹점 목록 상단 표시

#### 2.3.2 개별 가맹점 검색
- 가맹점 목록에서 클릭 시 위치 검색
- 검색 쿼리: "서울 은평구 [행정동] [상호명]"
- 검색 결과 캐싱

#### 2.3.3 전체 위치 표시
- 캐시된 모든 위치 정보 표시
- 지도 영역 자동 조정

### 2.4 필터링 및 정렬

#### 2.4.1 필터링
- **텍스트 검색**: 상호명으로 필터링
- **행정동 필터**: 특정 행정동만 표시
- **카테고리 필터**: 
  - 단일 선택 (드롭다운)
  - 다중 선택 (체크박스)

#### 2.4.2 정렬
- **거리순 정렬**: 
  - 오름차순/내림차순/기본
  - 현 지도에서 검색 후 활성화
  - 거리 정보가 있는 항목 우선 표시

### 2.5 UI/UX 기능

#### 2.5.1 테이블 표시
- 행정동, 상호, 카테고리, 주소, 상태 표시
- 거리 정보 (현 지도에서 검색 시)
- 페이지네이션 (10, 25, 50, 100개)
- 클릭 시 위치 검색

#### 2.5.2 상태 표시
- 미검색: 회색 배지
- 위치 찾음: 초록색 배지
- 위치 못찾음: 빨간색 배지

#### 2.5.3 통계 정보
- 전체 가맹점 수
- 행정동 수
- 검색 성공/실패 수

### 2.6 모바일 지원
- 반응형 디자인
- 전체화면 토글 버튼
- 터치 이벤트 지원

## 3. 데이터 구조

### 3.1 가맹점 정보
```javascript
{
  인덱스: number,
  행정동: string,
  상호: string,
  상세주소: string,
  표준산업분류명: string,
  도로명주소: string,
  지번주소: string,
  location: {
    lat: number,
    lng: number,
    roadAddress: string,
    jibunAddress: string
  },
  검색결과: '찾음' | '못찾음' | undefined,
  searched: boolean,
  거리: number (미터 단위),
  카테고리: string
}
```

### 3.2 IndexedDB 구조
- **StoreLocationCache DB**:
  - locations: 위치 정보 캐시
  - categories: 카테고리 정보
  - migrated_stores: 마이그레이션된 전체 데이터

## 4. 외부 의존성
- 카카오맵 API
- XLSX 라이브러리
- IndexedDB API